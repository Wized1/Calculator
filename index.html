<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#018786">
    <meta name="description" content="Endroid Calculator — Simple, fast, beautiful. Works offline.">
    <meta name="keywords" content="calculator, endroid, pwa, offline, math">
    <meta name="author" content="wized1">
    <meta name="robots" content="index, follow">

    <!-- Open Graph -->
    <meta property="og:title" content="Endroid Calculator">
    <meta property="og:description" content="A clean, fast, offline-first calculator.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://wized1.github.io/Calculator/">
    <meta property="og:image" content="https://wized1.github.io/Calculator/icon.svg">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Endroid Calculator">
    <meta name="twitter:description" content="Simple. Fast. Beautiful.">
    <meta name="twitter:image" content="https://wized1.github.io/Calculator/icon.svg">

    <!-- PWA MANIFEST -->
    <link rel="manifest" href="manifest.json">

    <!-- FAVICON & PWA ICON — THEME ADAPTIVE -->
    <link rel="icon" href="icon.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
    <link rel="icon" href="icon.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="icon.svg" media="(prefers-color-scheme: light)">

    <!-- Apple PWA -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Endroid Calc">

    <title>Endroid Calculator</title>

    <!-- Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <style>
        :root {
            --color-primary: #00897B;
            --color-on-primary: #ffffff;
            --color-surface: #F0F5F2;
            --color-background: #E8EBE9;
            --color-button-surface: #E0EBE8;
            --color-on-surface: #1E2021;
            --color-on-surface-subtle: #6D7873;
        }

        .dark-theme {
            --color-primary: #4DB6AC;
            --color-on-primary: #000000;
            --color-surface: #1E2021;
            --color-background: #121212;
            --color-button-surface: #2E3133;
            --color-on-surface: #E0EBE8;
            --color-on-surface-subtle: #96A39D;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: var(--color-background);
            font-family: 'Google Sans', 'Helvetica Neue', Arial, sans-serif;
            transition: background-color 0.3s;
        }

        .calculator {
            width: 320px;
            background-color: var(--color-surface);
            border-radius: 28px;
            padding: 24px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        .display-container {
            text-align: right;
            margin-bottom: 25px;
            padding: 10px 10px 10px 0;
            height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            overflow: hidden;
        }

        #previous-operand {
            font-size: 1.3em;
            color: var(--color-on-surface-subtle);
            height: 25px;
            white-space: nowrap;
            overflow: hidden;
            font-weight: 500;
        }

        #current-operand {
            font-size: 5em;
            color: var(--color-on-surface);
            font-weight: 300;
            height: 60px;
            line-height: 1;
        }

        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 14px;
        }

        .btn {
            width: 65px;
            height: 65px;
            border: none;
            border-radius: 50%;
            font-size: 1.6em;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.15s ease-in-out;
            user-select: none;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            font-family: inherit;
        }

        .material-symbols-rounded {
            font-family: 'Material Symbols Rounded', sans-serif !important;
            font-variation-settings: 'wght' 500, 'FILL' 0, 'opsz' 48;
        }

        .btn-default {
            background-color: var(--color-button-surface);
            color: var(--color-on-surface);
            font-weight: 500;
        }

        .btn-default:active, .btn-operator:active {
            background-color: var(--color-primary);
            color: var(--color-on-primary);
            transform: scale(0.95);
        }

        .btn-operator, .btn-theme-switch {
            background-color: var(--color-button-surface);
            color: var(--color-on-surface-subtle);
            font-size: 1.8em;
            font-weight: 400;
        }

        .btn-operator .material-symbols-rounded,
        .btn-theme-switch .material-symbols-rounded {
            font-size: 32px;
            font-variation-settings: 'wght' 400;
        }

        .divide-symbol { font-size: 1.8em; }

        .btn-blue-equals {
            background-color: var(--color-primary);
            color: var(--color-on-primary);
            font-size: 2.2em;
            font-weight: 600;
        }

        .btn-blue-equals .material-symbols-rounded {
            font-size: 40px;
            font-variation-settings: 'FILL' 1;
        }

        .btn-blue-equals:active {
            background-color: #006056;
            transform: scale(0.95);
        }

        .percent-symbol { font-size: 1.3em; }
    </style>
</head>
<body class="light-theme">

<div class="calculator">

    <div class="display-container">
        <div id="previous-operand"></div>
        <div id="current-operand">0</div>
    </div>

    <div class="buttons-grid">
        <button class="btn btn-operator" data-action="delete"><span class="material-symbols-rounded">backspace</span></button>
        <button class="btn btn-operator" data-action="percent"><span class="percent-symbol">%</span></button>
        <button class="btn btn-operator" data-action="clear"><span class="material-symbols-rounded">delete_sweep</span></button>
        <button class="btn btn-operator" data-action="operation" data-value="÷"><span class="divide-symbol">÷</span></button>

        <button class="btn btn-default" data-action="number" data-value="7">7</button>
        <button class="btn btn-default" data-action="number" data-value="8">8</button>
        <button class="btn btn-default" data-action="number" data-value="9">9</button>
        <button class="btn btn-operator" data-action="operation" data-value="×"><span class="material-symbols-rounded">close</span></button>

        <button class="btn btn-default" data-action="number" data-value="4">4</button>
        <button class="btn btn-default" data-action="number" data-value="5">5</button>
        <button class="btn btn-default" data-action="number" data-value="6">6</button>
        <button class="btn btn-operator" data-action="operation" data-value="−"><span class="material-symbols-rounded">remove</span></button>

        <button class="btn btn-default" data-action="number" data-value="1">1</button>
        <button class="btn btn-default" data-action="number" data-value="2">2</button>
        <button class="btn btn-default" data-action="number" data-value="3">3</button>
        <button class="btn btn-operator" data-action="operation" data-value="+"><span class="material-symbols-rounded">add</span></button>

        <button class="btn btn-default" data-action="number" data-value="0">0</button>
        <button class="btn btn-default" data-action="decimal" data-value=".">.</button>
        <button class="btn btn-blue-equals" data-action="equals"><span class="material-symbols-rounded">equal</span></button>
        <button class="btn btn-theme-switch" data-action="theme-switch" id="theme-switch-btn"><span class="material-symbols-rounded" id="theme-icon">light_mode</span></button>
    </div>
</div>

<script>
    class Calculator {
        constructor(previousOperandTextElement, currentOperandTextElement) {
            this.previousOperandTextElement = previousOperandTextElement
            this.currentOperandTextElement = currentOperandTextElement
            this.clear()
        }

        clear() {
            this.currentOperand = ''
            this.previousOperand = ''
            this.operation = undefined
            this.updateDisplay()
        }
        
        delete() {
            this.currentOperand = this.currentOperand.toString().slice(0, -1)
            this.updateDisplay()
        }
        
        appendNumber(number) {
            if (number === '.' && this.currentOperand.includes('.')) return
            this.currentOperand = this.currentOperand.toString() + number.toString()
            this.updateDisplay()
        }

        chooseOperation(operation) {
            if (this.currentOperand === '') return
            if (this.previousOperand !== '') this.compute()
            this.operation = operation
            this.previousOperand = this.currentOperand
            this.currentOperand = ''
            this.updateDisplay()
        }

        compute() {
            let computation
            const prev = parseFloat(this.previousOperand)
            const current = parseFloat(this.currentOperand)

            if (this.operation === '%') {
                if (isNaN(current)) return
                computation = current / 100
                this.previousOperand = ''
                this.currentOperand = computation.toString()
                this.operation = undefined
                return
            }
            
            if (isNaN(prev) || isNaN(current)) return
            
            switch (this.operation) {
                case '+': computation = prev + current; break
                case '−': computation = prev - current; break
                case '×': computation = prev * current; break
                case '÷': computation = prev / current; break
                default: return
            }

            this.currentOperand = parseFloat(computation.toFixed(10))
            this.operation = undefined
            this.previousOperand = ''
            this.updateDisplay()
        }
        
        getDisplayNumber(number) {
            const stringNumber = number.toString()
            const integerDigits = parseFloat(stringNumber.split('.')[0])
            const decimalDigits = stringNumber.split('.')[1]
            let integerDisplay

            if (isNaN(integerDigits)) {
                integerDisplay = '0'
            } else {
                integerDisplay = integerDigits.toLocaleString('en', { maximumFractionDigits: 0 })
            }

            return decimalDigits != null ? `${integerDisplay}.${decimalDigits}` : integerDisplay
        }

        updateDisplay() {
            this.currentOperandTextElement.innerText = this.getDisplayNumber(this.currentOperand)

            if (this.operation != null && this.previousOperand !== '') {
                this.previousOperandTextElement.innerText = 
                    `${this.getDisplayNumber(this.previousOperand)} ${this.operation}`
            } else {
                this.previousOperandTextElement.innerText = ''
            }
            
            if (this.currentOperand === '') {
                this.currentOperandTextElement.innerText = '0'
            }
        }
    }

    const body = document.body;
    const themeButton = document.getElementById('theme-switch-btn');
    const themeIcon = document.getElementById('theme-icon');
    
    function toggleTheme() {
        if (body.classList.contains('light-theme')) {
            body.classList.remove('light-theme');
            body.classList.add('dark-theme');
            themeIcon.innerText = 'dark_mode';
        } else {
            body.classList.remove('dark-theme');
            body.classList.add('light-theme');
            themeIcon.innerText = 'light_mode';
        }
    }

    const previousOperandTextElement = document.getElementById('previous-operand')
    const currentOperandTextElement = document.getElementById('current-operand')
    const calculator = new Calculator(previousOperandTextElement, currentOperandTextElement)
    const buttons = document.querySelectorAll('.btn')

    buttons.forEach(button => {
        button.addEventListener('click', () => {
            const action = button.dataset.action
            const value = button.dataset.value
            if (action === 'number' || action === 'decimal') calculator.appendNumber(value || button.innerText)
            else if (action === 'operation') calculator.chooseOperation(value || button.innerText)
            else if (action === 'equals') calculator.compute()
            else if (action === 'clear') calculator.clear()
            else if (action === 'delete') calculator.delete()
            else if (action === 'percent' && calculator.currentOperand !== '') calculator.chooseOperation('%')
            else if (action === 'theme-switch') toggleTheme()
        })
    })

    document.addEventListener('keydown', (e) => {
        const key = e.key
        if (/[0-9]/.test(key)) calculator.appendNumber(key)
        else if (key === '.') calculator.appendNumber('.')
        else if (key === 'Enter' || key === '=') calculator.compute()
        else if (key === 'Backspace') calculator.delete()
        else if (key === 'Escape') calculator.clear()
        else if (['+', '-', '*', '/'].includes(key)) {
            let op = key
            if (key === '*') op = '×'
            if (key === '/') op = '÷'
            calculator.chooseOperation(op)
        }
    })
</script>

<!-- ✔ ONLY addition: service worker registration -->
<script>
if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
        navigator.serviceWorker.register("service-worker.js")
        .catch(err => console.warn("SW registration failed:", err));
    });
}
</script>

</body>
        </html>
